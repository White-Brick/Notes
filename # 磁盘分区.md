# 磁盘分区

- 主要启动记录区（Master Boot Record，MBR）：可以安装启动管理程序的地方，有446bytes
- 分割表（partition table）：记录整颗硬盘分割的状态，有64bytes

MBR是很重要的，因为当系统在启动时会主动去读取这个区块内容，这样系统才会知道你的程序放在哪里且该如何进行启动。如果你要安装多重启动系统，MBR这个区块的管理就非常非常重要了。  

必须针对你的硬盘进行分割，这样硬盘才能可以被你使用。

# 磁盘分区表（partition table）
利用参考对照磁柱号码的方式来处理，在分割表所在的64bytes容量中，总共分为四组记录区，每组记录区记录了该区段的启始与结束的磁柱号码。  

由于分割表就只有64bytes而已，最多只能容纳四笔分割的记录，这四个分割的记录被称为主要primary或延伸extended分割槽。  

**总结**
1. 所谓的分割只是针对那个64bytes的分割表进行配置而已
2. 硬盘默认的分割表仅能写入四组分割资讯
3. 这四组分割资讯我们称为主要(Primary)或延伸(Extended)分割槽
4. 分割槽的最小单位为磁柱(cylinder)
5. 当系统要写入磁碟时，一定会参考磁盘分区表，才能针对某个分割槽进行数据的处理

# 文件系统管理
## 复习

- 圆形的磁盘盘（主要记录数据的部分）
- 机械手臂，与在机械手臂上的磁盘读取头（可擦写磁盘盘上的数据）
- 主轴马达，可以转动盘盘，让机械手臂的读取头在磁盘盘上读写数据

- `扇区（Sector）`为最小的物理存储单位，每个扇区为512bytes；
- 将扇区组成一个圆，那就是`磁柱（Cylinder）`，磁柱是`分割槽（Partition）`的最小单位；
- 第一个扇区最重要，里面有：（1）主要启动区`MBR`以及`分割表partition table`，其中MBR占有446bytes，而partition table占有64bytes


各种接口的磁盘在Linux中的文件名分别为：
- `/dev/sd[a-p][1-15]`：为SCSI，SATA，U盘，Flash闪盘等接口的磁盘文件名
- `/dev/hd[a-d][1-63]`：为IDE接口的磁盘文件名

所谓`磁盘分区`指的是告诉操作系统“我这颗磁盘在此分割槽可以存取的区域是由A磁柱到B磁柱之间的区块”，如此一来操作系统就能够知道他可以在所指定的区块内进行文件数据的读/写/搜寻等动作了。 也就是说，磁盘分区意即指定分割槽的启始与结束磁柱就是了

# 扩容Linux实例的磁盘
**检查分区和文件系统**
1. 查看当前磁盘的分区表格式
```shell
fdisk -lu [$Device]
```
> - [$Devide]为磁盘设备名称，如`dev/vda`、`/dev/vdb`等。

    [root@iZuf69796mi9saerxhswuyZ ~]# 
    fdisk -lu

    Disk /dev/vda: 64.4 GB, 64424509440 bytes, 125829120 sectors
    Units = sectors of 1 * 512 = 512 bytes
    Sector size (logical/physical): 512 bytes / 512 bytes
    I/O size (minimum/optimal): 512 bytes / 512 bytes
    Disk label type: dos
    Disk identifier: 0x000b2d99

    Device Boot      Start         End      Blocks   Id  System
    /dev/vda1   *        2048   125821079    62909516   83  Linux
系统返回如上，若**Disklabel type**参数值为**dos**，则分区表格式为MBR；若**Disklabel type**参数值为**gpt**，则分区表格式为GPT  


2. 查看文件系统的类型
```shell
blkid [$Partition]
```
> [$partition]对应当前磁盘的最后一个分区

    [root@iZuf69796mi9saerxhswuyZ ~]# blkid /dev/vda1
    /dev/vda1: UUID="1114fe9e-2309-4580-b183-d778e6d97397" TYPE="ext4"
系统返回如上，**TYPE="ext4"**


3. 根据分区的文件系统格式，检查文件系统状态，并确认文件系统状态正常
- 若文件系统格式为EXT（包含ext2、ext3、ext4），执行如下命令
```shell
e2fsck -n [$Partition]
```
- 若文件系统格式为XFS，执行如下命令
```shell
xfs_repair -n [$Partition]
```



**扩容分区**
由于新扩容的空间附加在虚拟磁盘末端，所以对于多分区场景，只支持对排在最后的分区进行扩容。以下扩容方法适用于系统盘与数据盘。请根据磁盘的最后一个分区的文件系统类型，选择对应的扩容方法。
> 注：为了防止数据丢失，不建议扩容已挂载的分区

**扩容MBR分区**
1. 执行如下命令，查看待扩容分区的磁盘信息
```shell
fdisk -lu [$Device]
```
确保该磁盘存在剩余空间用于扩容（分区所有size总和小于总磁盘空间）

2. 执行如下命令，卸载该磁盘的最后一个分区 
> 注：卸载前检查是否有进程读写该分区，建议终止该进程后再进行卸载磁盘操作。




