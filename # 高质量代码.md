# 高质量代码
代码质量总结起来：好看和好用。  
好看指代码可读性好，容易理解，容易维护，别人接手了不骂你；好用则指代码健壮，不容易出错，机器跑着不骂你。即使出错，也容易定位，容易止损和恢复。

## 编码：优秀的方案需要优秀的代码
**可读性**
- 控制复杂度
- self-document

**分层规范**
合理的代码分层，能控制各层的复杂度，以分层的思路去设计，也能提高代码的复用性。自己熟悉的就是好的，不谈六边形架构、清晰架构、DODAF等概念，推荐DDD最基础的四分层架构

    用户界面/接口层
    应用层
    领域层
    基础设施层

```
-- bootstrap
    -- BeanConfig
-- application
    -- pv
        -- ChannelPvApplicationService
    -- sns
-- domain
    -- abtest
        -- AbtestService
    -- address
    -- coupon
        -- entity
            -- Coupon
            -- CouponStatus
            -- CategoryCouponTemplate
    -- category
    -- user
        -- UserRepository
        -- service
            -- OneIdService
            -- UserService
    -- item
        -- ItemRepostory
    -- live
        -- LiveStatus
-- infrastructure
    -- concurrent
        -- ThreadPoolExecutorFactory
        -- MonitorableCallerRunsPolicy
    -- dal
        -- IGraphDal
        -- TuringDal
        -- DefaultUserRepository
    -- dao
        -- MybatisItemDao
    -- util
        -- DateUtil
        -- MoneyUtil
        -- UriUtil
    -- monitor
        -- Event
        -- Timing
        -- TimingAspect
        -- TimingEvent
        -- Monitors
-- view
    -- atomicwidget
        -- BannerWidget
        -- CrazySubsidyWidget
        -- FeedItemsWidget
        -- NavigateBarWidget
        -- LiveWidget
    -- page
        -- HomeScreenPage
        -- CategoryFeedsPage
        -- SearchCardPage
    -- widget
        -- Widget
        -- DispatchableWidget
        -- Debuggable
        -- AbstractWidget
        -- AbstractDispatchableWidget
        -- WidgetDispatcher
        -- WidgetResult
        -- WidgetContextIncompatibleException
```
上述项目结构中，因为是导购项目，view相当于用户界面层，application是应用层，domain是领域层，infrastructure是基础设施层。

**代码规范**
命名  
- 命名不用泛称（反例：processData）
- 用尽量完整的单词描述清楚作用和意图，不要怕字多

日志  
- 所有后台都要有操作日志、数据变更日志
- 日志要配置异步写盘
- 线上仅保留WARN和ERROR级别日志
- 所有日志都要有traceID
- 异常日志要有堆栈、入参、能说清楚是什么错误的信息
- 打印日志时，禁止直接用JSON工具将对象转换成String

异常  
- 怎么抛：尽量使用非受检异常，提高代码可读性
- 怎么处理：统一异常用切面处理
- 异常catch范围尽量小，分清稳定代码和非稳定代码
- 禁止直接吞掉异常
- 时刻警惕NPE，多用Optional处理


注释  
- 注释只为了说明为什么这么做，不用来说明是在做什么

面向对象  
- 遵循原则：SRP/OCP/LSP/ISP/DIP
- 尽量只暴露行为，不暴露数据
- 慎用继承，优先使用组合方式


其他规范  
- 方法行数保持在一屏之内（30行以内）
- 代码提交commit message一定要讲清楚做了啥控制每次提交的代码量（一个功能一提交）
- 参数尽量用不可变对象（不对入参做修改，保持明确的入参和出参）尽量不用隐式入参（ThreadLocal）
- 数据结构无随机读取时，用LinkedList替代ArrayList
- 风格做好分层，同层用统一的风格（设计/编码）


